(()=>{"use strict";function e(e){return"INPUT"===e.tagName||"TEXTAREA"===e.tagName||"DIV"===e.tagName&&e.isContentEditable}function t(e){var t=document.createElement("div");return t.textContent=e,t.style.position="absolute",t.style.backgroundColor="yellow",t.style.border="1px solid black",t.style.padding="5px",t.style.zIndex="1000",document.body.appendChild(t),t}document.addEventListener("focus",(function(t){var n;if(e(t.target)){var o=document.title,i=(null===(n=document.querySelector('meta[name="description"]'))||void 0===n?void 0:n.content)||"",a=document.body.innerText;chrome.runtime.sendMessage({type:"STORE_CONTEXT",context:{title:o,description:i,bodyText:a}})}}),!0),document.addEventListener("input",(function(n){if(e(n.target)){var o=n.target.value.slice(-1);if(" "===o||"\n"===o){var i=t("Thinking...");n.target.addEventListener("keypress",(function(e){i.remove()})),chrome.runtime.sendMessage({type:"TEXT_BOX_UPDATED",textBoxContent:n.target.value})}}}),!0),chrome.runtime.onMessage.addListener((function(n,o,i){var a=document.activeElement;if("COMPLETION_RECEIVED"===n.type&&n.completion&&e(a)){var r=t(n.completion);a.addEventListener("keydown",(function(e){if("Tab"===e.key){e.preventDefault();var t=a.selectionStart;a.value=a.value.slice(0,t)+r.textContent+a.value.slice(t),a.selectionStart=t+n.completion.length,a.selectionEnd=t+n.completion.length,r.remove()}"Escape"===e.key&&r.remove(),e.key.length>1&&" "!==e.key&&"\n"!==e.key||r.remove()}))}}))})();